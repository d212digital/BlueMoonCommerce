@model eCommerce.Web.ViewModels.ProductDetailsViewModel

@{
    Layout = "~/Views/Shared/_WebLayout.cshtml";
}

@if (Model != null && Model.Product != null)
{
    var currentLanguageProductRecord = Model.Product.ProductRecords.FirstOrDefault(x => x.LanguageID == AppDataHelper.CurrentLanguage.ID);

    var currentLanguageCategoryRecord = Model.Product.Category.CategoryRecords.FirstOrDefault(x => x.LanguageID == AppDataHelper.CurrentLanguage.ID);

    Model.PageTitle = currentLanguageProductRecord != null ? currentLanguageProductRecord.Name : string.Empty;
    Model.PageDescription = currentLanguageProductRecord != null ? currentLanguageProductRecord.Summary : string.Empty;
    Model.PageURL = Url.ProductDetailsWeb(category: Model.Product.Category.SanitizedName, ID: Model.Product.ID);

    var thumbnail = Model.Product.ProductPictures != null ? Model.Product.ProductPictures.Count == 1 ? Model.Product.ProductPictures.FirstOrDefault() : Model.Product.ProductPictures.Count > 0 ? Model.Product.ProductPictures.Where(x => x.PictureID == Model.Product.ThumbnailPictureID).FirstOrDefault() : null : null;

    if (thumbnail != null)
    {
        Model.PageImageURL = PictureHelper.PageImageURL(thumbnail.Picture.URL, isCompletePath: true);
    }
    else
    {
        Model.PageImageURL = PictureHelper.PageImageURL("products.jpg");
    }

    var productPrice = Model.Product.Discount.HasValue && Model.Product.Discount.Value > 0 ? Model.Product.Discount.Value : Model.Product.Price;

    var haveParentCategory = Model.Product.Category != null && Model.Product.Category.ParentCategory != null;

    var productStockTextColor = Model.Product.StockQuantity > 0 ? "text-success bold" : "text-danger bold";

    <div class="breacrumb-section">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb-text product-more">
                        <a href="/web">
                            <i class="fas fa-home mr-1"></i>
                        </a>
                        @if (haveParentCategory)
                        {
                            var currentLanguageParentCategoryRecord = Model.Product.Category.ParentCategory.CategoryRecords.FirstOrDefault(x => x.LanguageID == AppDataHelper.CurrentLanguage.ID);

                            <a href="@Url.SearchProducts(category: Model.Product.Category.ParentCategory.SanitizedName)">@(currentLanguageParentCategoryRecord != null ? currentLanguageParentCategoryRecord.Name : string.Empty)</a>
                        }
                        <a href="@Url.SearchProducts(category: Model.Product.Category.SanitizedName)">@(currentLanguageCategoryRecord != null ? currentLanguageCategoryRecord.Name : string.Empty)</a>
                        <span>@(currentLanguageProductRecord != null ? currentLanguageProductRecord.Name : string.Empty)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <section class="services-area services-eight">
        <!--======  Start Section Title Five ======-->
        <div class="section-title-five">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="content">
                            <h6>
                                Back to > <a href="@Url.SearchProducts(category: Model.Product.Category.SanitizedName)">
                                    <span>
                                        @(currentLanguageCategoryRecord != null ? currentLanguageCategoryRecord.Name : string.Empty)
                                    </span>
                                </a>
                            </h6>
                            <div class="pd-title">

                                <h2>
                                    @(currentLanguageProductRecord != null ? currentLanguageProductRecord.Name : string.Empty)
                                </h2>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- row -->
            </div>
            <!-- container -->
        </div>
        <!--======  End Section Title Five ======-->

    </section>

    <section class="services-area services-nine">
        <div class="container">
            <div class="row mt-1">
                <div class="col-lg-12">
                    @if (Model.Product.ProductPictures != null && Model.Product.ProductPictures.Count > 0)
                    {
                        var i = 0;
                        var firstProductPicture = Model.Product.ProductPictures.First();

                        <div id="carouselIndicators" class="product-gallery-carousel carousel slide" data-ride="carousel">
                            @if (Model.Product.ProductPictures.Count > 1)
                            {
                                <ol class="carousel-indicators product-carousel-indicators">
                                    @foreach (var picture in Model.Product.ProductPictures)
                                    {
                                        var active = picture == firstProductPicture ? "active" : string.Empty;

                                        <li class="@active" data-target="#carouselIndicators" data-slide-to="@i"></li>

                                        i++;
                                    }
                                </ol>
                            }
                            <div class="carousel-inner product-carousel-inner" role="listbox">
                                @{
                                    var j = 0;
                                }
                                @foreach (var productPicture in Model.Product.ProductPictures)
                                {
                                    j++;

                                    var active = productPicture == firstProductPicture ? "active" : string.Empty;

                                    <div class="carousel-item @active text-center">
                                        @Html.PictureWithZoomAttribute(productPicture.Picture, "", alt: currentLanguageProductRecord != null ? currentLanguageProductRecord.Name : string.Empty, id: string.Format("imgZoom{0}", j))
                                    </div>
                                }
                            </div>
                            @if (Model.Product.ProductPictures.Count > 1)
                            {
                                <a class="carousel-control-prev product-carousel-prev" href="#carouselIndicators" role="button" data-slide="prev">
                                    <span class="carousel-control-prev-icon"></span>
                                </a>
                                <a class="carousel-control-next product-carousel-next" href="#carouselIndicators" role="button" data-slide="next">
                                    <span class="carousel-control-next-icon"></span>
                                </a>
                            }
                        </div>
                    }
                    else
                    {
                        <div id="carouselIndicators" class="product-gallery-carousel carousel slide" data-ride="carousel">
                            <div class="carousel-inner product-carousel-inner" role="listbox">
                                <div class="carousel-item active text-center">
                                    @Html.Picture("", "", alt: currentLanguageProductRecord != null ? currentLanguageProductRecord.Name : string.Empty)
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
<div class="container">
        <div class="product-tab">
            <div class="tab-item">
                <ul class="nav" role="tablist">
                    @if (currentLanguageProductRecord != null && !string.IsNullOrEmpty(currentLanguageProductRecord.Description))
                    {
                        <li>
                            <a data-toggle="tab" href="#description-tab" role="tab" class="active">@("PP.ProductDetails.Description".Localized())</a>
                        </li>
                    }
                    @if (currentLanguageProductRecord != null && currentLanguageProductRecord.ProductSpecifications != null && currentLanguageProductRecord.ProductSpecifications.Count > 0)
                    {
                        <li>
                            <a data-toggle="tab" href="#specification-tab" role="tab">@("PP.ProductDetails.ProductSpecifications".Localized())</a>
                        </li>
                    }

                </ul>
            </div>
            <div class="tab-item-content">
                <div class="tab-content">
                    @if (currentLanguageProductRecord != null && !string.IsNullOrEmpty(currentLanguageProductRecord.Description))
                    {
                        <div class="tab-pane fade-in active show" id="description-tab" role="tabpanel">
                            <div class="product-content ml-3 pt-3">
                                @Html.Raw(currentLanguageProductRecord.Description)
                            </div>
                        </div>
                    }
                    @if (currentLanguageProductRecord != null && currentLanguageProductRecord.ProductSpecifications != null && currentLanguageProductRecord.ProductSpecifications.Count > 0)
                    {
                        <div class="tab-pane fade" id="specification-tab" role="tabpanel">
                            @{ Html.RenderPartial("_ProductSpecifications", currentLanguageProductRecord.ProductSpecifications); }
                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
    </section>


}
